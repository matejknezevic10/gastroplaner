<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore Rules - Problem beheben</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #ef4444;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .error-box {
            background: #fee;
            border-left: 5px solid #ef4444;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            color: #991b1b;
        }
        
        .error-box h2 {
            color: #ef4444;
            margin-bottom: 10px;
        }
        
        .step {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #ef4444;
        }
        
        .step-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 10px;
        }
        
        .step h3 {
            color: #ef4444;
            display: inline-block;
            font-size: 1.3em;
        }
        
        .code-block {
            background: #2d3748;
            color: #10b981;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.95em;
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .copy-btn:hover {
            background: #059669;
        }
        
        .success-box {
            background: #d1f2eb;
            border-left: 5px solid #10b981;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            color: #047857;
        }
        
        .warning-box {
            background: #fef3c7;
            border-left: 5px solid #f59e0b;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .info-box {
            background: #dbeafe;
            border-left: 5px solid #3b82f6;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .screenshot-placeholder {
            background: #e0e0e0;
            border: 3px dashed #999;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            color: #666;
        }
        
        .nav-path {
            background: white;
            border: 2px solid #ef4444;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            color: #ef4444;
            font-size: 1.1em;
        }
        
        .button {
            display: inline-block;
            padding: 15px 30px;
            background: #ef4444;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            margin: 10px 5px;
        }
        
        .button:hover {
            background: #dc2626;
        }
        
        .icon {
            font-size: 3em;
            margin: 20px 0;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-box {
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        
        .comparison-box.before {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .comparison-box.after {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .comparison-box h4 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Firestore Rules Problem</h1>
        
        <div class="error-box">
            <h2>‚ùå Fehler: "Missing or insufficient permissions"</h2>
            <p><strong>Was bedeutet das?</strong></p>
            <p>Firebase blockiert den Zugriff, weil die Firestore-Sicherheitsregeln noch nicht richtig konfiguriert sind.</p>
            <br>
            <p><strong>L√∂sung:</strong> Firestore-Regeln in der Firebase Console anpassen (dauert 2 Minuten)</p>
        </div>
        
        <h2 style="color: #ef4444; margin: 40px 0 20px 0;">üöÄ Schnelle L√∂sung in 5 Schritten</h2>
        
        <!-- Schritt 1 -->
        <div class="step">
            <span class="step-number">1</span>
            <h3>Firebase Console √∂ffnen</h3>
            <p style="margin-top: 15px;">Gehe zu: <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a></p>
            <p>W√§hle <strong>dein Projekt</strong> aus</p>
            <div class="screenshot-placeholder">
                <div class="icon">üî•</div>
                <p>Firebase Console Hauptseite</p>
                <p>Klicke auf dein Projekt</p>
            </div>
        </div>
        
        <!-- Schritt 2 -->
        <div class="step">
            <span class="step-number">2</span>
            <h3>Firestore Database √∂ffnen</h3>
            <p style="margin-top: 15px;">Navigation:</p>
            <div class="nav-path">
                Build ‚Üí Firestore Database
            </div>
            <div class="screenshot-placeholder">
                <div class="icon">üóÑÔ∏è</div>
                <p>Linkes Men√º ‚Üí <strong>Build</strong></p>
                <p>Dann: <strong>Firestore Database</strong></p>
            </div>
        </div>
        
        <!-- Schritt 3 -->
        <div class="step">
            <span class="step-number">3</span>
            <h3>Regeln √∂ffnen</h3>
            <p style="margin-top: 15px;">Klicke oben auf den Tab <strong>"Regeln"</strong> / <strong>"Rules"</strong></p>
            <div class="screenshot-placeholder">
                <div class="icon">‚öñÔ∏è</div>
                <p>Tabs: Daten | Regeln | Indizes | Nutzung</p>
                <p>Klicke auf: <strong>Regeln</strong></p>
            </div>
        </div>
        
        <!-- Schritt 4 -->
        <div class="step">
            <span class="step-number">4</span>
            <h3>Regeln ersetzen</h3>
            
            <div class="comparison">
                <div class="comparison-box before">
                    <h4 style="color: #ef4444;">‚ùå VORHER (blockiert alles)</h4>
                    <div class="code-block" style="font-size: 0.85em;">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if false;
    }
  }
}</div>
                    <p style="color: #991b1b;">Blockiert alle Zugriffe!</p>
                </div>
                
                <div class="comparison-box after">
                    <h4 style="color: #10b981;">‚úÖ NACHHER (erlaubt Zugriff)</h4>
                    <div class="code-block" style="font-size: 0.85em;">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}</div>
                    <p style="color: #047857;">Erlaubt Zugriff f√ºr Entwicklung!</p>
                </div>
            </div>
            
            <div class="warning-box">
                <strong>‚ö†Ô∏è Wichtig:</strong><br>
                1. <strong>Markiere ALLES</strong> im Regel-Editor (Strg+A / Cmd+A)<br>
                2. <strong>L√∂sche</strong> den alten Inhalt<br>
                3. <strong>Kopiere</strong> den neuen Code unten<br>
                4. <strong>F√ºge ein</strong> (Strg+V / Cmd+V)
            </div>
            
            <p><strong>Code zum Kopieren:</strong></p>
            <div class="code-block" id="rules-code">
                <button class="copy-btn" onclick="copyRules()">üìã Kopieren</button>
                <pre>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ENTWICKLUNGS-MODUS: Alle k√∂nnen lesen/schreiben
    match /{document=**} {
      allow read, write: if true;
    }
  }
}</pre>
            </div>
        </div>
        
        <!-- Schritt 5 -->
        <div class="step">
            <span class="step-number">5</span>
            <h3>Ver√∂ffentlichen</h3>
            <p style="margin-top: 15px;">Klicke oben rechts auf den Button <strong>"Ver√∂ffentlichen"</strong> / <strong>"Publish"</strong></p>
            <div class="screenshot-placeholder">
                <div class="icon">üöÄ</div>
                <p>Button: <strong>Ver√∂ffentlichen</strong></p>
                <p>Oben rechts in der Ecke</p>
            </div>
            <div class="success-box">
                <strong>‚úÖ Geschafft!</strong><br>
                Warte ~5 Sekunden, dann sind die neuen Regeln aktiv!
            </div>
        </div>
        
        <!-- Test -->
        <h2 style="color: #10b981; margin: 40px 0 20px 0;">üß™ Jetzt testen!</h2>
        
        <div class="info-box">
            <h3 style="color: #1e40af; margin-bottom: 15px;">Teste die Registrierung</h3>
            <ol style="margin-left: 20px;">
                <li>Gehe zur√ºck zu <code>tenant-zugang.html</code></li>
                <li>Klicke "Restaurant registrieren"</li>
                <li>F√ºlle das Formular aus</li>
                <li>Klicke "Restaurant registrieren"</li>
                <li><strong>Sollte jetzt funktionieren!</strong> ‚úÖ</li>
            </ol>
        </div>
        
        <!-- Erweiterte Regeln -->
        <h2 style="color: #ef4444; margin: 40px 0 20px 0;">üîê Sicherere Regeln (Optional)</h2>
        
        <div class="warning-box">
            <p><strong>Die obigen Regeln sind f√ºr Entwicklung gedacht!</strong></p>
            <p>F√ºr Produktion sollten Sie sicherere Regeln verwenden.</p>
        </div>
        
        <p><strong>Sicherere Regeln f√ºr Multi-Tenancy:</strong></p>
        <div class="code-block" id="secure-rules">
            <button class="copy-btn" onclick="copySecureRules()">üìã Kopieren</button>
            <pre>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Tenants Collection
    match /tenants/{tenantId} {
      // Jeder kann neue Tenants erstellen (Registrierung)
      allow create: if true;
      
      // Jeder kann Tenants lesen (f√ºr Login-Validierung)
      allow read: if true;
      
      // Updates erlaubt
      allow update: if true;
      
      // Alle Sub-Collections (mitarbeiter, schichten, etc.)
      match /{collection}/{document=**} {
        allow read, write: if true;
      }
    }
    
    // Alles andere ist verboten
    match /{document=**} {
      allow read, write: if false;
    }
  }
}</pre>
        </div>
        
        <div class="info-box">
            <h3 style="color: #1e40af; margin-bottom: 10px;">üí° Unterschied</h3>
            <p><strong>Einfache Regeln:</strong> Alles erlaubt (gut f√ºr Tests)</p>
            <p><strong>Sichere Regeln:</strong> Nur Tenant-Daten erlaubt (besser f√ºr Produktion)</p>
        </div>
        
        <!-- Troubleshooting -->
        <h2 style="color: #ef4444; margin: 40px 0 20px 0;">üÜò Falls es nicht funktioniert</h2>
        
        <div class="error-box">
            <h3 style="margin-bottom: 10px;">Problem: Immer noch "Permission denied"</h3>
            <p><strong>L√∂sungen:</strong></p>
            <ol style="margin: 15px 0 0 20px;">
                <li>Warte 10-30 Sekunden (Rules brauchen Zeit zum Aktivieren)</li>
                <li>Lade die Seite neu (Strg+Shift+R / Cmd+Shift+R)</li>
                <li>Pr√ºfe ob du auf "Ver√∂ffentlichen" geklickt hast</li>
                <li>Pr√ºfe ob der Code richtig kopiert wurde (keine Fehler)</li>
            </ol>
        </div>
        
        <div class="warning-box">
            <h3 style="margin-bottom: 10px;">Problem: "Firestore not activated"</h3>
            <p><strong>L√∂sung:</strong></p>
            <ol style="margin: 15px 0 0 20px;">
                <li>Firestore Database wurde noch nicht aktiviert</li>
                <li>Gehe zu: Build ‚Üí Firestore Database</li>
                <li>Klicke "Datenbank erstellen"</li>
                <li>W√§hle "Testmodus" oder "Produktionsmodus"</li>
                <li>Region w√§hlen (z.B. europe-west3)</li>
            </ol>
        </div>
        
        <!-- Links -->
        <div style="text-align: center; margin-top: 40px;">
            <a href="https://console.firebase.google.com" target="_blank" class="button">
                üî• Zur Firebase Console
            </a>
            <a href="tenant-zugang.html" class="button" style="background: #10b981;">
                üéØ Registrierung testen
            </a>
        </div>
        
        <!-- Footer -->
        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0; color: #666; font-size: 0.9em;">
            <p><strong>Weitere Hilfe:</strong></p>
            <p>üìÑ MULTI-TENANCY-DOKUMENTATION.md</p>
            <p>üîß firebase-diagnose.html</p>
            <p style="margin-top: 20px;">Version 1.0 | Januar 2026</p>
        </div>
    </div>
    
    <script>
        function copyRules() {
            const code = `rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ENTWICKLUNGS-MODUS: Alle k√∂nnen lesen/schreiben
    match /{document=**} {
      allow read, write: if true;
    }
  }
}`;
            
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ Code kopiert!\n\nJetzt in Firebase Console einf√ºgen (Strg+V)');
            });
        }
        
        function copySecureRules() {
            const code = `rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Tenants Collection
    match /tenants/{tenantId} {
      // Jeder kann neue Tenants erstellen (Registrierung)
      allow create: if true;
      
      // Jeder kann Tenants lesen (f√ºr Login-Validierung)
      allow read: if true;
      
      // Updates erlaubt
      allow update: if true;
      
      // Alle Sub-Collections (mitarbeiter, schichten, etc.)
      match /{collection}/{document=**} {
        allow read, write: if true;
      }
    }
    
    // Alles andere ist verboten
    match /{document=**} {
      allow read, write: if false;
    }
  }
}`;
            
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ Sichere Regeln kopiert!\n\nJetzt in Firebase Console einf√ºgen (Strg+V)');
            });
        }
    </script>
</body>
</html>
